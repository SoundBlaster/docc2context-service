# Task 1.2: Deploy the CLI App from Source Code

**Status:** Completed  
**Priority:** Critical  
**Phase:** 1  
**Dependencies:** Task 1.1 (completed)  
**Estimated Time:** 4-6 hours  
**Source:** PRD ยง5, Workplan.md

## Description

Deploy the CLI app from the source code placed in https://github.com/SoundBlaster/docc2context (clone, build Swift binary, integrate into Docker image).

## Subtasks

### 1. Clone or download the docc2context source code from GitHub
- [x] Add git to Dockerfile build stage (if not already present)
- [x] Clone the repository: `https://github.com/SoundBlaster/docc2context`
- [x] Verify source code is accessible in build context
- [x] Determine the correct branch/tag to use (check repository for releases or main branch)

**Acceptance Criteria:**
- Source code is available in Docker build context
- Repository is successfully cloned during build

### 2. Build the Swift CLI binary from source
- [x] Install Swift build tools in Docker image (if not already present)
  - Check if Swift compiler is available in the swift-base stage
  - If needed, ensure Swift toolchain is installed for building
- [x] Compile the CLI using Swift Package Manager
  - Navigate to cloned repository directory
  - Run `swift build -c release` or equivalent build command
  - Verify build succeeds without errors
- [x] Ensure binary is built for Linux (if deploying on Linux)
  - Confirm target architecture matches deployment environment
  - Test binary compatibility

**Acceptance Criteria:**
- Swift CLI binary is successfully compiled
- Binary is built for correct target platform (Linux)
- Build process completes without errors

### 3. Integrate the binary into the Docker image
- [x] Copy the compiled binary to a standard location
  - Target: `/usr/local/bin/docc2context` (or similar PATH location)
- [x] Ensure binary has execute permissions
  - Use `chmod +x` or set permissions in COPY command
- [x] Verify binary is accessible in PATH
  - Test that `docc2context` command is found without full path

**Acceptance Criteria:**
- Binary is installed in Docker image at `/usr/local/bin/docc2context` (or standard PATH location)
- Binary has execute permissions
- Binary is accessible via `docc2context` command (no full path needed)

### 4. Test binary execution
- [x] Verify `docc2context --version` or similar command works
  - Test version command in Docker container
  - Verify output is correct (binary responds to `--help` command)
- [x] Ensure binary can be executed from Python subprocess
  - Create a simple Python test script
  - Use `subprocess.run()` to execute `docc2context --version`
  - Verify subprocess execution succeeds

**Acceptance Criteria:**
- Binary responds to basic commands (version check, help, etc.)
- Binary can be executed from Python subprocess
- No runtime errors when executing the binary

## Implementation Details

### Files to Modify/Create

1. **Dockerfile** (modify)
   - Add build stage for cloning and compiling Swift CLI
   - Add steps to clone repository
   - Add Swift build commands
   - Copy compiled binary to final image

2. **docker-compose.yml** (optional, verify)
   - Ensure it works with updated Dockerfile

3. **Test script** (create, optional)
   - Simple Python script to test binary execution
   - Can be temporary for validation

### Dockerfile Structure

The Dockerfile should be updated to include:
- A build stage that clones the docc2context repository
- Swift build commands to compile the binary
- Copy the binary from build stage to final image
- Ensure binary is in PATH and has execute permissions

### Verification Commands

```bash
# Build the Docker image
docker build -t docc2context-service .

# Test binary execution in container
docker run --rm docc2context-service docc2context --version

# Test from Python subprocess (interactive)
docker run -it --rm docc2context-service python3
# Then in Python:
# import subprocess
# result = subprocess.run(['docc2context', '--version'], capture_output=True, text=True)
# print(result.stdout, result.stderr, result.returncode)
```

## Definition of Done

- [x] CLI source code is accessible in the build context
- [x] Swift CLI binary is successfully compiled
- [x] Binary is installed in Docker image at a standard location
- [x] Binary is executable and accessible from Python subprocess
- [x] Binary responds to basic commands (version check, help, etc.)
- [x] Docker image builds successfully with the integrated binary
- [x] All acceptance criteria from Workplan.md are met

## Notes

- The Dockerfile already has Swift runtime libraries from Task 1.1
- Need to determine if Swift compiler is needed in build stage or if we can use a different approach
- Check the docc2context repository for build instructions or README
- Consider caching the build to speed up subsequent builds

**Archived:** 2025-01-27

