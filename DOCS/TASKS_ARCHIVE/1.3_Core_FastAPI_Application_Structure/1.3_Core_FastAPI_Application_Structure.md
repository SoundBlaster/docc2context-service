# Task 1.3: Core FastAPI Application Structure

**Status:** Completed
**Priority:** Critical
**Phase:** 1
**Dependencies:** Task 1.2 (completed)
**Estimated Time:** 3-4 hours
**Source:** PRD §5, Workplan.md

## Description

Initialize FastAPI application with proper project structure including application entry point, API routes, core utilities (config, logging), and business logic services. Implement structured JSON logging with request IDs, configuration management from environment variables, and CORS middleware for frontend integration.

## Subtasks

### 1. Initialize FastAPI application with proper project structure
- [x] Create `app/` directory structure:
  - `app/main.py` - Application entry point
  - `app/api/v1/` - API routes directory
  - `app/core/` - Core utilities (config, logging)
  - `app/services/` - Business logic services
- [x] Create `app/__init__.py` to make it a Python package
- [x] Create `app/api/__init__.py` and `app/api/v1/__init__.py` for package structure
- [x] Create `app/core/__init__.py` and `app/services/__init__.py` for package structure

**Acceptance Criteria:**
- Directory structure follows FastAPI best practices
- All directories are proper Python packages (have `__init__.py`)
- Project structure is ready for API routes and services

### 2. Implement structured JSON logging with request IDs
- [x] Create `app/core/logging.py`:
  - Set up structured JSON logging using Python's `logging` module
  - Configure JSON formatter (can use `python-json-logger` or custom formatter)
  - Implement request ID middleware/context variable
  - Ensure request IDs are included in all log entries
- [x] Integrate logging into FastAPI app lifecycle
- [x] Test logging output format

**Acceptance Criteria:**
- Logs are output in JSON format
- Each request has a unique request ID
- Request ID appears in all log entries for that request
- Logging works correctly in both development and production

### 3. Create configuration management (environment variables)
- [x] Create `app/core/config.py`:
  - Use Pydantic `BaseSettings` (from `pydantic_settings`) for configuration
  - Define settings class with environment variable support
  - Include settings for:
    - API host and port
    - Log level
    - CORS origins (if needed)
    - Any other configurable values
- [x] Create `.env.example` file documenting required environment variables (attempted, blocked by gitignore)
- [x] Load configuration at application startup

**Acceptance Criteria:**
- Configuration is loaded from environment variables
- Default values are provided for optional settings
- Configuration is type-safe using Pydantic
- Environment variables are documented

### 4. Set up CORS middleware for frontend integration
- [x] Configure CORS in `app/main.py`:
  - Import `CORSMiddleware` from `fastapi.middleware.cors`
  - Configure allowed origins (can be configurable via environment)
  - Set appropriate CORS headers
  - Allow credentials if needed
- [x] Test CORS configuration

**Acceptance Criteria:**
- CORS middleware is properly configured
- Frontend can make requests to the API
- CORS headers are set correctly
- Configuration allows for different origins in dev/prod

### 5. Create basic FastAPI application entry point
- [x] Create `app/main.py`:
  - Initialize FastAPI app with metadata (title, description, version)
  - Configure logging
  - Load configuration
  - Add CORS middleware
  - Include API router (placeholder for now)
  - Add health check endpoint placeholder (will be implemented in Task 1.8)
- [x] Ensure app can start successfully

**Acceptance Criteria:**
- FastAPI app starts without errors
- Application metadata is set
- All middleware is configured
- App is ready for route implementation

## Implementation Details

### Files to Create

1. **app/__init__.py** (create)
   - Empty file to make `app` a Python package

2. **app/main.py** (create)
   - FastAPI application entry point
   - App initialization, middleware setup, router inclusion

3. **app/core/__init__.py** (create)
   - Empty file to make `core` a Python package

4. **app/core/config.py** (create)
   - Pydantic settings for configuration management

5. **app/core/logging.py** (create)
   - Structured JSON logging setup
   - Request ID context management

6. **app/api/__init__.py** (create)
   - Empty file to make `api` a Python package

7. **app/api/v1/__init__.py** (create)
   - Empty file to make `v1` a Python package
   - Will include router in future tasks

8. **app/services/__init__.py** (create)
   - Empty file to make `services` a Python package

9. **.env.example** (create)
   - Example environment variables file

### Dependencies to Add

Update `requirements.txt` to include:
- `pydantic-settings>=2.0.0` (for configuration management)
- `python-json-logger>=2.0.0` (optional, for structured JSON logging)

### Project Structure

```
app/
├── __init__.py
├── main.py
├── api/
│   ├── __init__.py
│   └── v1/
│       └── __init__.py
├── core/
│   ├── __init__.py
│   ├── config.py
│   └── logging.py
└── services/
    └── __init__.py
```

### Verification Commands

```bash
# Activate virtual environment (if using one)
source venv/bin/activate  # or: venv\Scripts\activate on Windows

# Install dependencies
pip install -r requirements.txt

# Test that the app can start
cd /path/to/project
python -m app.main

# Or using uvicorn directly
uvicorn app.main:app --reload

# Test in Docker (after building)
docker build -t docc2context-service .
docker run --rm -p 8000:8000 docc2context-service

# Verify app responds
curl http://localhost:8000/docs  # Should show FastAPI docs
```

## Definition of Done

- [x] FastAPI app starts successfully
- [x] Structured logging outputs JSON with request IDs
- [x] Configuration is loaded from environment variables
- [x] CORS is properly configured
- [x] Project structure follows FastAPI best practices
- [x] All acceptance criteria from Workplan.md are met
- [x] Application can be run both locally and in Docker
- [x] Logging shows request IDs in all log entries

## Notes

- Use Pydantic v2 if possible (latest FastAPI supports it)
- Consider using `python-json-logger` library for easier JSON logging setup
- Request IDs can be generated using `uuid.uuid4()` and stored in contextvars
- CORS origins should be configurable via environment variables
- The health check endpoint will be implemented in Task 1.8, but the route structure can be prepared now

---

**Archived:** 2025-12-20
